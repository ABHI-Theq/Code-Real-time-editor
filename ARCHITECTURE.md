# ðŸ—ï¸ System Architecture

Complete system architecture, data flow diagrams, and component structure.

---

## System Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         CLIENT BROWSER                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚   Home Page  â”‚  â”‚ Editor Page  â”‚  â”‚  Components  â”‚        â”‚
â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚        â”‚
â”‚  â”‚ - Form       â”‚  â”‚ - RealEditor â”‚  â”‚ - Chat       â”‚        â”‚
â”‚  â”‚ - Room Join  â”‚  â”‚ - Language   â”‚  â”‚ - UserList   â”‚        â”‚
â”‚  â”‚              â”‚  â”‚   Selector   â”‚  â”‚ - Sidebar    â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚         â”‚                 â”‚                  â”‚                 â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                           â”‚                                     â”‚
â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚                  â”‚ SocketContext   â”‚                           â”‚
â”‚                  â”‚ (WebSocket)     â”‚                           â”‚
â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚                           â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   INTERNET     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           â”‚         BACKEND SERVER              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                           â”‚                                     â”‚
â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚                  â”‚   Socket.IO     â”‚                           â”‚
â”‚                  â”‚   Server        â”‚                           â”‚
â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚                           â”‚                                     â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚         â”‚                 â”‚                 â”‚                 â”‚
â”‚    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚    â”‚  Room    â”‚    â”‚   User     â”‚   â”‚  Editor    â”‚          â”‚
â”‚    â”‚  Manager â”‚    â”‚   Manager  â”‚   â”‚  Content   â”‚          â”‚
â”‚    â”‚          â”‚    â”‚            â”‚   â”‚  Store     â”‚          â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                                â”‚
â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚                  â”‚  Express API   â”‚                           â”‚
â”‚                  â”‚  /api/execute  â”‚                           â”‚
â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚                           â”‚                                    â”‚
â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚                  â”‚ Code Executor   â”‚                          â”‚
â”‚                  â”‚ (codeExecutor.js)â”‚                         â”‚
â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                           â”‚                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   INTERNET     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Piston API    â”‚                    â”‚   Judge0 API    â”‚
â”‚  (Free)        â”‚                    â”‚   (Optional)    â”‚
â”‚                â”‚                    â”‚                 â”‚
â”‚ - No API Key   â”‚                    â”‚ - Requires Key  â”‚
â”‚ - 15+ langs    â”‚                    â”‚ - More features â”‚
â”‚ - Default      â”‚                    â”‚ - Fallback      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow Diagrams

### 1. User Joins Room

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User A  â”‚         â”‚ Server  â”‚         â”‚ User B  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚                   â”‚                   â”‚
     â”‚ 1. Join Room      â”‚                   â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                   â”‚
     â”‚ {username, roomId}â”‚                   â”‚
     â”‚                   â”‚                   â”‚
     â”‚                   â”‚ 2. Add to room    â”‚
     â”‚                   â”‚    Store in map   â”‚
     â”‚                   â”‚                   â”‚
     â”‚ 3. Current contentâ”‚                   â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                   â”‚
     â”‚ {content: "..."}  â”‚                   â”‚
     â”‚                   â”‚                   â”‚
     â”‚                   â”‚ 4. Notify others  â”‚
     â”‚                   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚                   â”‚ "User A joined"   â”‚
     â”‚                   â”‚                   â”‚
```

### 2. Code Editing Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User A  â”‚         â”‚ Server  â”‚         â”‚ User B  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚                   â”‚                   â”‚
     â”‚ 1. Types "hello"  â”‚                   â”‚
     â”‚ (local update)    â”‚                   â”‚
     â”‚                   â”‚                   â”‚
     â”‚ 2. Send update    â”‚                   â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                   â”‚
     â”‚ {content, roomId} â”‚                   â”‚
     â”‚                   â”‚                   â”‚
     â”‚                   â”‚ 3. Store content  â”‚
     â”‚                   â”‚    editorMap[id]  â”‚
     â”‚                   â”‚                   â”‚
     â”‚                   â”‚ 4. Broadcast      â”‚
     â”‚                   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚                   â”‚ {content:"hello"} â”‚
     â”‚                   â”‚                   â”‚
     â”‚                   â”‚                   â”‚ 5. Update editor
     â”‚                   â”‚                   â”‚    (User B sees)
```

### 3. Code Execution Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frontendâ”‚    â”‚ Backend  â”‚    â”‚ Piston  â”‚    â”‚ Judge0   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚              â”‚               â”‚              â”‚
     â”‚ 1. Run Code  â”‚               â”‚              â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚               â”‚              â”‚
     â”‚ POST /executeâ”‚               â”‚              â”‚
     â”‚              â”‚               â”‚              â”‚
     â”‚              â”‚ 2. Try Piston â”‚              â”‚
     â”‚              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚              â”‚
     â”‚              â”‚               â”‚              â”‚
     â”‚              â”‚ 3. Success?   â”‚              â”‚
     â”‚              â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚
     â”‚              â”‚               â”‚              â”‚
     â”‚              â”‚ 4. If fail &  â”‚              â”‚
     â”‚              â”‚    has key    â”‚              â”‚
     â”‚              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚              â”‚               â”‚              â”‚
     â”‚              â”‚ 5. Result     â”‚              â”‚
     â”‚              â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚              â”‚               â”‚              â”‚
     â”‚ 6. Display   â”‚               â”‚              â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤               â”‚              â”‚
     â”‚ {output,     â”‚               â”‚              â”‚
     â”‚  error}      â”‚               â”‚              â”‚
```

### 4. Multi-User Conflict Resolution

```
Time    User A          Server          User B
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
T0      Editor: ""      Content: ""     Editor: ""
        
T1      Types "hello"   
        Local: "hello"  
        
T2      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> Receives
                        Stores: "hello"
                        
T3                      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> Receives
                                        Updates: "hello"
                        
T4                                      Types "world"
                                        Local: "world"
                        
T5                      <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Sends
                        Stores: "world"
                        
T6      <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Broadcasts
        Updates: "world"
        
T7      Final: "world"  Final: "world"  Final: "world"
```

## Component Architecture

### Frontend Components

```
App.jsx
â”œâ”€â”€ SocketContextProvider
â”‚   â””â”€â”€ Socket.IO Connection
â”‚
â”œâ”€â”€ Routes
â”‚   â”œâ”€â”€ Home (/)
â”‚   â”‚   â””â”€â”€ Form
â”‚   â”‚       â”œâ”€â”€ Room ID Input
â”‚   â”‚       â”œâ”€â”€ Username Input
â”‚   â”‚       â””â”€â”€ Create/Join Button
â”‚   â”‚
â”‚   â””â”€â”€ EditorPage (/editor/:roomId)
â”‚       â”œâ”€â”€ Mobile Header
â”‚       â”‚   â””â”€â”€ Navigation Buttons
â”‚       â”‚
â”‚       â”œâ”€â”€ Desktop Sidebar
â”‚       â”‚   â”œâ”€â”€ Members Button
â”‚       â”‚   â””â”€â”€ Chat Button
â”‚       â”‚
â”‚       â”œâ”€â”€ Sidebar Content
â”‚       â”‚   â”œâ”€â”€ EditorAside
â”‚       â”‚   â”‚   â”œâ”€â”€ User List (Client components)
â”‚       â”‚   â”‚   â”œâ”€â”€ Copy Room ID
â”‚       â”‚   â”‚   â””â”€â”€ Leave Room
â”‚       â”‚   â”‚
â”‚       â”‚   â””â”€â”€ Chat
â”‚       â”‚       â”œâ”€â”€ Message List
â”‚       â”‚       â””â”€â”€ Message Input
â”‚       â”‚
â”‚       â”œâ”€â”€ Editor Area
â”‚       â”‚   â”œâ”€â”€ Language Selector
â”‚       â”‚   â”œâ”€â”€ Run Code Button
â”‚       â”‚   â”œâ”€â”€ RealEditor (Ace Editor)
â”‚       â”‚   â”‚   â”œâ”€â”€ Syntax Highlighting
â”‚       â”‚   â”‚   â”œâ”€â”€ Autocompletion
â”‚       â”‚   â”‚   â””â”€â”€ Typing Indicators
â”‚       â”‚   â”‚
â”‚       â”‚   â””â”€â”€ Output Panel
â”‚       â”‚       â”œâ”€â”€ Execution Results
â”‚       â”‚       â””â”€â”€ Error Messages
â”‚       â”‚
â”‚       â””â”€â”€ MessageNotification
â”‚           â””â”€â”€ Popup for new messages
```

### Backend Architecture

```
server.js
â””â”€â”€ socket.js
    â”œâ”€â”€ HTTP Server
    â””â”€â”€ Socket.IO Server
        â”œâ”€â”€ Connection Handler
        â”‚   â”œâ”€â”€ user-joined-room
        â”‚   â”œâ”€â”€ user-left
        â”‚   â”œâ”€â”€ editor-update
        â”‚   â”œâ”€â”€ user-typing
        â”‚   â”œâ”€â”€ typing-stopped
        â”‚   â”œâ”€â”€ GroupMessage
        â”‚   â””â”€â”€ disconnect
        â”‚
        â””â”€â”€ Data Stores
            â”œâ”€â”€ userSocketMap (username â†’ socketId)
            â”œâ”€â”€ roomData (roomId â†’ users[])
            â”œâ”€â”€ editorContentMap (roomId â†’ content)
            â””â”€â”€ userRoomMap (username â†’ roomId)

app.js
â”œâ”€â”€ Express Server
â”œâ”€â”€ Middleware
â”‚   â”œâ”€â”€ CORS
â”‚   â”œâ”€â”€ Rate Limiting
â”‚   â”œâ”€â”€ Body Parser
â”‚   â””â”€â”€ Error Handler
â”‚
â””â”€â”€ Routes
    â”œâ”€â”€ GET /
    â”œâ”€â”€ GET /api/languages
    â””â”€â”€ POST /api/execute
        â””â”€â”€ codeExecutor.js
            â”œâ”€â”€ executeWithPiston()
            â”œâ”€â”€ executeWithJudge0()
            â””â”€â”€ executeCode() (main)
```

## State Management

### Frontend State (EditorPage)

```javascript
// UI State
const [isMobile, setIsMobile] = useState(false)
const [sidebarOpen, setSidebarOpen] = useState(false)
const [editoraside, setEditoraside] = useState(true)
const [chatsection, setChatsection] = useState(false)
const [output, setOutput] = useState(false)

// Editor State
const [selectedLanguage, setSelectedLanguage] = useState('javascript')
const [editorContent, setEditorContent] = useState(defaultCode)
const [executionResult, setExecutionResult] = useState('')
const [isExecuting, setIsExecuting] = useState(false)

// Collaboration State
const [userData, setUserData] = useState([])
const [messages, setMessages] = useState([])
const [messageNotification, setMessageNotification] = useState(null)
const [isUserAlreadyInRoom, setIsUserAlreadyInRoom] = useState(false)

// Refs (for stable socket callbacks)
const currentUsernameRef = useRef(username)
const currentRoomIdRef = useRef(roomId)
const hasJoinedRoomRef = useRef(false)
```

### Backend State (socket.js)

```javascript
// User Management
const userSocketMap = new Map()
// { "alice": "socket123", "bob": "socket456" }

// Room Management
const roomData = new Map()
// { "room1": [
//     { username: "alice", socketId: "socket123" },
//     { username: "bob", socketId: "socket456" }
// ]}

// Content Storage
const editorContentMap = new Map()
// { "room1": "console.log('hello')" }

// User-Room Mapping
const userRoomMap = new Map()
// { "alice": "room1", "bob": "room1" }
```

## Security Layers

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Client Request                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Layer 1: CORS Validation               â”‚
â”‚  - Check origin                         â”‚
â”‚  - Verify allowed methods               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Layer 2: Rate Limiting                 â”‚
â”‚  - 10 requests per minute               â”‚
â”‚  - Per IP address                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Layer 3: Input Validation              â”‚
â”‚  - Check code length (max 10KB)         â”‚
â”‚  - Validate language                    â”‚
â”‚  - Sanitize inputs                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Layer 4: Execution Timeout             â”‚
â”‚  - Max 15 seconds                       â”‚
â”‚  - Kill long-running processes          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Layer 5: Sandboxed Execution           â”‚
â”‚  - Piston/Judge0 containers             â”‚
â”‚  - Isolated environment                 â”‚
â”‚  - No file system access                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Safe Result                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Performance Considerations

### Optimization Strategies

1. **Debouncing Editor Updates**
   - Wait 300ms before sending updates
   - Reduces network traffic
   - Improves performance with fast typers

2. **Lazy Loading Components**
   - Load Ace Editor modes on demand
   - Reduce initial bundle size

3. **Memoization**
   - Use `useCallback` for event handlers
   - Use `useMemo` for expensive computations
   - Prevent unnecessary re-renders

4. **WebSocket Efficiency**
   - Only broadcast to room members
   - Don't send updates to sender
   - Use binary data when possible

5. **Code Execution**
   - Cache execution results (future)
   - Use faster Piston API by default
   - Fallback to Judge0 only when needed

## Scalability

### Current Limitations

- In-memory storage (lost on restart)
- Single server instance
- No load balancing
- No persistent storage

### Scaling Solutions

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Load Balancer                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚              â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
    â”‚  Server 1  â”‚  â”‚ Server 2  â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
           â”‚              â”‚
           â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  Redis Cluster  â”‚
         â”‚  (Shared State) â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Implementation:**
1. Use Redis for shared state
2. Socket.IO Redis adapter
3. Horizontal scaling
4. Session persistence
5. Database for history

---

**Last Updated:** December 2024
